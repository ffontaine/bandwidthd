CC = @CC@
LDFLAGS = @LDFLAGS@ @LIBS@
OBS= bandwidthd.o graph.o conf.tab.o conf.l.o

CFLAGS= -Wall @CFLAGS@ @CPPFLAGS@ @DEFS@
NONWALLCFLAGS= @CFLAGS@ @CPPFLAGS@ @DEFS@

# Debugging stuff
#CFLAGS += -Wall -pg -DPROFILE
#CFLAGS += -Wall -g -DDEBUG 

all: bandwidthd

bandwidthd: $(OBS) bandwidthd.h
	$(CC) $(CFLAGS) $(OBS) -o bandwidthd $(LDFLAGS) 

conf.tab.c: conf.y
	bison -pbdconfig_ -d conf.y

conf.l.c: conf.l
	lex -Pbdconfig_ -s -i -t -I conf.l > conf.l.c

clean:
	rm -f *.o bandwidthd *~ DEADJOE core

# Resets us to distributable code
dist-clean: conf.tab.c conf.l.c clean
	rm -f config.h config.log config.status Makefile

# Deletes all derived files
# You must have flex, bison, and autoconf to build the source if you run this
# Before you can do anything after running this you must run "autoheader; autoconf"
real-clean: dist-clean
	rm -f conf.tab.c conf.tab.h conf.l.c config.h.in configure 

install: all
	if [ ! -d $(DESTDIR)/usr/local/bandwidthd/etc ] ; then mkdir -p $(DESTDIR)/usr/local/bandwidthd/etc ; fi
	if [ ! -d $(DESTDIR)/usr/local/bandwidthd/htdocs ] ; then mkdir -p $(DESTDIR)/usr/local/bandwidthd/htdocs ; fi
	cp bandwidthd $(DESTDIR)/usr/local/bandwidthd	
	if [ ! -f $(DESTDIR)/usr/local/bandwidthd/etc/bandwidthd.conf ] ; then cp etc/bandwidthd.conf $(DESTDIR)/usr/local/bandwidthd/etc/ ; fi
	cp htdocs/legend.gif $(DESTDIR)/usr/local/bandwidthd/htdocs/
	cp htdocs/logo.gif $(DESTDIR)/usr/local/bandwidthd/htdocs/

#**** Stuff where -WALL is turned off to reduce the noise in a compile so I can see my own errors *******************
conf.l.o: conf.l.c
	$(CC) $(NONWALLCFLAGS) -c -o conf.l.o conf.l.c	
